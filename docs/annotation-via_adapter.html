---

title: VIA Annotation Adapter


keywords: fastai
sidebar: home_sidebar

summary: "VIA annotation adapter. To use the VIA annotation tool, refer to the <a href='http://www.robots.ox.ac.uk/~vgg/software/via/'>Homepage</a>."
description: "VIA annotation adapter. To use the VIA annotation tool, refer to the <a href='http://www.robots.ox.ac.uk/~vgg/software/via/'>Homepage</a>."
nb_path: "annotation-via_adapter.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: annotation-via_adapter.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Current supported annotations:</p>
<ul>
<li>circle</li>
<li>ellipse</li>
<li>point</li>
<li>polygon</li>
<li>polyline</li>
<li>rectangle</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Current supported annotation tool versions:</p>
<ul>
<li><a href="https://www.robots.ox.ac.uk/~vgg/software/via/via-1.0.6.html">VIA version 1 (v1.0.6)</a></li>
<li><a href="https://www.robots.ox.ac.uk/~vgg/software/via/via.html">VIA version 2 (v2.0.11)</a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The adapter has the following parameters:</p>
<ul>
<li><code>--path</code>: the path to the base folder containing the annotations (e.g.: <em>data/image_object_detection/my_collection</em>)</li>
<li><code>--version</code>: The version format to read or write the anotations. If not set, parse the annotation-format on read, use version <em>2</em> on write annotation</li>
<li><code>--categories_file_name</code>: The path to the categories file if not set, default to <em>categories.txt</em></li>
<li><code>--annotations_file_name</code>: The name of annotations file. If not set, default to <em>via_region_data.json</em></li>
<li><code>--category_label_key</code>: The key, the category label key is stored in the annotation file, default to <em>category</em>.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="VIAAnnotationAdapter" class="doc_header"><code>class</code> <code>VIAAnnotationAdapter</code><a href="https://github.com/AI-Force/aiforce/tree/master/aiforce/annotation/via_adapter.py#L43" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>VIAAnnotationAdapter</code>(<strong><code>path</code></strong>, <strong><code>version</code></strong>=<em><code>None</code></em>, <strong><code>categories_file_name</code></strong>=<em><code>None</code></em>, <strong><code>annotations_file_name</code></strong>=<em><code>None</code></em>, <strong><code>category_label_key</code></strong>=<em><code>None</code></em>) :: <a href="/aiforce/annotation-core.html#AnnotationAdapter"><code>AnnotationAdapter</code></a></p>
</blockquote>
<p>Adapter to read and write annotations in the VIA annotation.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AnnotationAdapter.list_files" class="doc_header"><code>AnnotationAdapter.list_files</code><a href="https://github.com/AI-Force/aiforce/tree/master/aiforce/annotation/core.py#L200" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AnnotationAdapter.list_files</code>(<strong><code>subset_type</code></strong>=<em><code>&lt;SubsetType.TRAINVAL: 'trainval'&gt;</code></em>)</p>
</blockquote>
<p>List all physical files in a sub-set.
<code>subset_type</code>: the subset type to list
return: a list of file paths if subset type exist, else an empty list</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="VIAAnnotationAdapter.read_annotations" class="doc_header"><code>VIAAnnotationAdapter.read_annotations</code><a href="https://github.com/AI-Force/aiforce/tree/master/aiforce/annotation/via_adapter.py#L95" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>VIAAnnotationAdapter.read_annotations</code>(<strong><code>subset_type</code></strong>=<em><code>&lt;SubsetType.TRAINVAL: 'trainval'&gt;</code></em>)</p>
</blockquote>
<p>Reads a VIA annotations file.
Supports JSON and CSV file format.
<code>subset_type</code>: the subset type to read
return: the annotations as dictionary</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AnnotationAdapter.read_categories" class="doc_header"><code>AnnotationAdapter.read_categories</code><a href="https://github.com/AI-Force/aiforce/tree/master/aiforce/annotation/core.py#L235" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AnnotationAdapter.read_categories</code>()</p>
</blockquote>
<p>Read categories.
return: a list of category names</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AnnotationAdapter.write_files" class="doc_header"><code>AnnotationAdapter.write_files</code><a href="https://github.com/AI-Force/aiforce/tree/master/aiforce/annotation/core.py#L209" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AnnotationAdapter.write_files</code>(<strong><code>file_paths</code></strong>, <strong><code>subset_type</code></strong>=<em><code>&lt;SubsetType.TRAINVAL: 'trainval'&gt;</code></em>)</p>
</blockquote>
<p>Write physical files in a sub-set.
<code>file_paths</code>: a list of file paths to write
<code>subset_type</code>: the subset type to write into
return: a list of written target file paths</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="VIAAnnotationAdapter.write_annotations" class="doc_header"><code>VIAAnnotationAdapter.write_annotations</code><a href="https://github.com/AI-Force/aiforce/tree/master/aiforce/annotation/via_adapter.py#L227" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>VIAAnnotationAdapter.write_annotations</code>(<strong><code>annotations</code></strong>, <strong><code>subset_type</code></strong>=<em><code>&lt;SubsetType.TRAINVAL: 'trainval'&gt;</code></em>)</p>
</blockquote>
<p>Writes a VIA annotations file and copy the corresponding source files.
Supports JSON and CSV file format.
Format is inferred from the annotations_file setting.
<code>annotations</code>: the annotations as dictionary
<code>subset_type</code>: the subset type to write
return: a list of written target file paths</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AnnotationAdapter.write_categories" class="doc_header"><code>AnnotationAdapter.write_categories</code><a href="https://github.com/AI-Force/aiforce/tree/master/aiforce/annotation/core.py#L254" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AnnotationAdapter.write_categories</code>(<strong><code>categories</code></strong>)</p>
</blockquote>
<p>Write categories.
<code>categories</code>: a list of category names</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="VIAAnnotationAdapter.argparse" class="doc_header"><code>VIAAnnotationAdapter.argparse</code><a href="https://github.com/AI-Force/aiforce/tree/master/aiforce/annotation/via_adapter.py#L70" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>VIAAnnotationAdapter.argparse</code>(<strong><code>prefix</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Returns the argument parser containing argument definition for command line use.
<code>prefix</code>: a parameter prefix to set, if needed
return: the argument parser</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test-the-Adapter">Test the Adapter<a class="anchor-link" href="#Test-the-Adapter"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Define the test data to use in tests. 
We declare 2 annotations, one with all supported region shapes set and one with no region set at all.
The we define the result formats in CSV and JSON for VIA version 1 and 2.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span><span class="p">,</span> <span class="n">mock_open</span>
<span class="kn">from</span> <span class="nn">fastcore.test</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">CATEGORIES_TEST_DATA</span> <span class="o">=</span> <span class="s2">&quot;foo</span><span class="se">\n</span><span class="s2">bar&quot;</span>
<span class="n">TEST_FILEPATH</span> <span class="o">=</span> <span class="s2">&quot;testpath&quot;</span>
<span class="n">ANNOTATION_TEST_DATA</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;foo.jpg12&quot;</span><span class="p">:</span> <span class="n">Annotation</span><span class="p">(</span><span class="n">annotation_id</span><span class="o">=</span><span class="s2">&quot;foo.jpg12&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">TEST_FILEPATH</span><span class="p">,</span> <span class="s2">&quot;foo.jpg&quot;</span><span class="p">),</span> <span class="n">regions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Region</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">RegionShape</span><span class="o">.</span><span class="n">CIRCLE</span><span class="p">,</span> <span class="n">points_x</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">points_y</span><span class="o">=</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">radius_x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">radius_y</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]),</span>
        <span class="n">Region</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">RegionShape</span><span class="o">.</span><span class="n">ELLIPSE</span><span class="p">,</span> <span class="n">points_x</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="n">points_y</span><span class="o">=</span><span class="p">[</span><span class="mi">31</span><span class="p">],</span> <span class="n">radius_x</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">radius_y</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]),</span>
        <span class="n">Region</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">RegionShape</span><span class="o">.</span><span class="n">POINT</span><span class="p">,</span> <span class="n">points_x</span><span class="o">=</span><span class="p">[</span><span class="mi">40</span><span class="p">],</span> <span class="n">points_y</span><span class="o">=</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]),</span>
        <span class="n">Region</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">RegionShape</span><span class="o">.</span><span class="n">POLYGON</span><span class="p">,</span> <span class="n">points_x</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span> <span class="n">points_y</span><span class="o">=</span><span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">81</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]),</span>
        <span class="n">Region</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">RegionShape</span><span class="o">.</span><span class="n">POLYLINE</span><span class="p">,</span> <span class="n">points_x</span><span class="o">=</span><span class="p">[</span><span class="mi">52</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">82</span><span class="p">],</span> <span class="n">points_y</span><span class="o">=</span><span class="p">[</span><span class="mi">53</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">83</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]),</span>
        <span class="n">Region</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">RegionShape</span><span class="o">.</span><span class="n">RECTANGLE</span><span class="p">,</span> <span class="n">points_x</span><span class="o">=</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">points_y</span><span class="o">=</span><span class="p">[</span><span class="mi">91</span><span class="p">,</span> <span class="mi">111</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]),</span>
    <span class="p">]),</span>
    <span class="s2">&quot;bar.jpg34&quot;</span><span class="p">:</span> <span class="n">Annotation</span><span class="p">(</span><span class="n">annotation_id</span><span class="o">=</span><span class="s2">&quot;bar.jpg34&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">TEST_FILEPATH</span><span class="p">,</span> <span class="s2">&quot;bar.jpg&quot;</span><span class="p">))</span>
<span class="p">}</span>
<span class="c1"># The CSV test data for VIA version 1</span>
<span class="n">DATA_CSV_V1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;#filename,file_size,file_attributes,region_count,region_id,region_shape_attributes,region_attributes</span>
<span class="s2">foo.jpg,12,&quot;</span><span class="si">{}</span><span class="s2">&quot;,6,0,&quot;{&quot;&quot;name&quot;&quot;:&quot;&quot;circle&quot;&quot;,&quot;&quot;cx&quot;&quot;:20,&quot;&quot;cy&quot;&quot;:21,&quot;&quot;r&quot;&quot;:5}&quot;,&quot;{&quot;&quot;category&quot;&quot;:&quot;&quot;foo&quot;&quot;}&quot;</span>
<span class="s2">foo.jpg,12,&quot;</span><span class="si">{}</span><span class="s2">&quot;,6,1,&quot;{&quot;&quot;name&quot;&quot;:&quot;&quot;ellipse&quot;&quot;,&quot;&quot;cx&quot;&quot;:30,&quot;&quot;cy&quot;&quot;:31,&quot;&quot;rx&quot;&quot;:10,&quot;&quot;ry&quot;&quot;:15}&quot;,&quot;{&quot;&quot;category&quot;&quot;:&quot;&quot;bar&quot;&quot;}&quot;</span>
<span class="s2">foo.jpg,12,&quot;</span><span class="si">{}</span><span class="s2">&quot;,6,2,&quot;{&quot;&quot;name&quot;&quot;:&quot;&quot;point&quot;&quot;,&quot;&quot;cx&quot;&quot;:40,&quot;&quot;cy&quot;&quot;:41}&quot;,&quot;{&quot;&quot;category&quot;&quot;:&quot;&quot;foo&quot;&quot;}&quot;</span>
<span class="s2">foo.jpg,12,&quot;</span><span class="si">{}</span><span class="s2">&quot;,6,3,&quot;{&quot;&quot;name&quot;&quot;:&quot;&quot;polygon&quot;&quot;,&quot;&quot;all_points_x&quot;&quot;:[50, 60, 70, 80],&quot;&quot;all_points_y&quot;&quot;:[51, 61, 71, 81]}&quot;,&quot;{&quot;&quot;category&quot;&quot;:&quot;&quot;bar&quot;&quot;}&quot;</span>
<span class="s2">foo.jpg,12,&quot;</span><span class="si">{}</span><span class="s2">&quot;,6,4,&quot;{&quot;&quot;name&quot;&quot;:&quot;&quot;polyline&quot;&quot;,&quot;&quot;all_points_x&quot;&quot;:[52, 62, 72, 82],&quot;&quot;all_points_y&quot;&quot;:[53, 63, 73, 83]}&quot;,&quot;{&quot;&quot;category&quot;&quot;:&quot;&quot;foo&quot;&quot;}&quot;</span>
<span class="s2">foo.jpg,12,&quot;</span><span class="si">{}</span><span class="s2">&quot;,6,5,&quot;{&quot;&quot;name&quot;&quot;:&quot;&quot;rect&quot;&quot;,&quot;&quot;x&quot;&quot;:90,&quot;&quot;y&quot;&quot;:91,&quot;&quot;width&quot;&quot;:10,&quot;&quot;height&quot;&quot;:20}&quot;,&quot;{&quot;&quot;category&quot;&quot;:&quot;&quot;bar&quot;&quot;}&quot;</span>
<span class="s2">bar.jpg,34,&quot;</span><span class="si">{}</span><span class="s2">&quot;,0,0,&quot;</span><span class="si">{}</span><span class="s2">&quot;,&quot;</span><span class="si">{}</span><span class="s2">&quot;</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># The CSV test data for VIA version 2</span>
<span class="n">DATA_CSV_V2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;filename,file_size,file_attributes,region_count,region_id,region_shape_attributes,region_attributes</span>
<span class="s2">foo.jpg,12,&quot;</span><span class="si">{}</span><span class="s2">&quot;,6,0,&quot;{&quot;&quot;name&quot;&quot;:&quot;&quot;circle&quot;&quot;,&quot;&quot;cx&quot;&quot;:20,&quot;&quot;cy&quot;&quot;:21,&quot;&quot;r&quot;&quot;:5}&quot;,&quot;{&quot;&quot;category&quot;&quot;:&quot;&quot;foo&quot;&quot;}&quot;</span>
<span class="s2">foo.jpg,12,&quot;</span><span class="si">{}</span><span class="s2">&quot;,6,1,&quot;{&quot;&quot;name&quot;&quot;:&quot;&quot;ellipse&quot;&quot;,&quot;&quot;cx&quot;&quot;:30,&quot;&quot;cy&quot;&quot;:31,&quot;&quot;rx&quot;&quot;:10,&quot;&quot;ry&quot;&quot;:15,&quot;&quot;theta&quot;&quot;:0.6}&quot;,&quot;{&quot;&quot;category&quot;&quot;:&quot;&quot;bar&quot;&quot;}&quot;</span>
<span class="s2">foo.jpg,12,&quot;</span><span class="si">{}</span><span class="s2">&quot;,6,2,&quot;{&quot;&quot;name&quot;&quot;:&quot;&quot;point&quot;&quot;,&quot;&quot;cx&quot;&quot;:40,&quot;&quot;cy&quot;&quot;:41}&quot;,&quot;{&quot;&quot;category&quot;&quot;:&quot;&quot;foo&quot;&quot;}&quot;</span>
<span class="s2">foo.jpg,12,&quot;</span><span class="si">{}</span><span class="s2">&quot;,6,3,&quot;{&quot;&quot;name&quot;&quot;:&quot;&quot;polygon&quot;&quot;,&quot;&quot;all_points_x&quot;&quot;:[50, 60, 70, 80],&quot;&quot;all_points_y&quot;&quot;:[51, 61, 71, 81]}&quot;,&quot;{&quot;&quot;category&quot;&quot;:&quot;&quot;bar&quot;&quot;}&quot;</span>
<span class="s2">foo.jpg,12,&quot;</span><span class="si">{}</span><span class="s2">&quot;,6,4,&quot;{&quot;&quot;name&quot;&quot;:&quot;&quot;polyline&quot;&quot;,&quot;&quot;all_points_x&quot;&quot;:[52, 62, 72, 82],&quot;&quot;all_points_y&quot;&quot;:[53, 63, 73, 83]}&quot;,&quot;{&quot;&quot;category&quot;&quot;:&quot;&quot;foo&quot;&quot;}&quot;</span>
<span class="s2">foo.jpg,12,&quot;</span><span class="si">{}</span><span class="s2">&quot;,6,5,&quot;{&quot;&quot;name&quot;&quot;:&quot;&quot;rect&quot;&quot;,&quot;&quot;x&quot;&quot;:90,&quot;&quot;y&quot;&quot;:91,&quot;&quot;width&quot;&quot;:10,&quot;&quot;height&quot;&quot;:20}&quot;,&quot;{&quot;&quot;category&quot;&quot;:&quot;&quot;bar&quot;&quot;}&quot;</span>
<span class="s2">bar.jpg,34,&quot;</span><span class="si">{}</span><span class="s2">&quot;,0,0,&quot;</span><span class="si">{}</span><span class="s2">&quot;,&quot;</span><span class="si">{}</span><span class="s2">&quot;</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># The JSON test data for VIA version 1</span>
<span class="n">DATA_JSON_V1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">&quot;foo.jpg12&quot;:{&quot;fileref&quot;:&quot;&quot;,&quot;size&quot;:12,&quot;filename&quot;:&quot;foo.jpg&quot;,&quot;base64_img_data&quot;:&quot;&quot;,&quot;file_attributes&quot;:</span><span class="si">{}</span><span class="s2">,&quot;regions&quot;:{</span>
<span class="s2">&quot;0&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;circle&quot;,&quot;cx&quot;:20,&quot;cy&quot;:21,&quot;r&quot;:5},&quot;region_attributes&quot;:{&quot;category&quot;:&quot;foo&quot;}},</span>
<span class="s2">&quot;1&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;ellipse&quot;,&quot;cx&quot;:30,&quot;cy&quot;:31,&quot;rx&quot;:10,&quot;ry&quot;:15},&quot;region_attributes&quot;:{&quot;category&quot;:&quot;bar&quot;}},</span>
<span class="s2">&quot;2&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;point&quot;,&quot;cx&quot;:40,&quot;cy&quot;:41},&quot;region_attributes&quot;:{&quot;category&quot;:&quot;foo&quot;}},</span>
<span class="s2">&quot;3&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;polygon&quot;,&quot;all_points_x&quot;:[50, 60, 70, 80],&quot;all_points_y&quot;:[51, 61, 71, 81]},&quot;region_attributes&quot;:{&quot;category&quot;:&quot;bar&quot;}},</span>
<span class="s2">&quot;4&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;polyline&quot;,&quot;all_points_x&quot;:[52, 62, 72, 82],&quot;all_points_y&quot;:[53, 63, 73, 83]},&quot;region_attributes&quot;:{&quot;category&quot;:&quot;foo&quot;}},</span>
<span class="s2">&quot;5&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;rect&quot;,&quot;x&quot;:90,&quot;y&quot;:91,&quot;width&quot;:10,&quot;height&quot;:20},&quot;region_attributes&quot;:{&quot;category&quot;:&quot;bar&quot;}}}},</span>
<span class="s2">&quot;bar.jpg34&quot;:{&quot;fileref&quot;:&quot;&quot;,&quot;size&quot;:34,&quot;filename&quot;:&quot;bar.jpg&quot;,&quot;base64_img_data&quot;:&quot;&quot;,&quot;file_attributes&quot;:</span><span class="si">{}</span><span class="s2">,&quot;regions&quot;:</span><span class="si">{}</span><span class="s2">}}&quot;&quot;&quot;</span>
<span class="c1"># The JSON test data for VIA version 2</span>
<span class="n">DATA_JSON_V2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">&quot;foo.jpg12&quot;:{&quot;fileref&quot;:&quot;&quot;,&quot;size&quot;:12,&quot;filename&quot;:&quot;foo.jpg&quot;,&quot;regions&quot;:[</span>
<span class="s2">{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;circle&quot;,&quot;cx&quot;:20,&quot;cy&quot;:21,&quot;r&quot;:5},&quot;region_attributes&quot;:{&quot;category&quot;:&quot;foo&quot;}},</span>
<span class="s2">{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;ellipse&quot;,&quot;cx&quot;:30,&quot;cy&quot;:31,&quot;rx&quot;:10,&quot;ry&quot;:15,&quot;theta&quot;:0.6},&quot;region_attributes&quot;:{&quot;category&quot;:&quot;bar&quot;}},</span>
<span class="s2">{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;point&quot;,&quot;cx&quot;:40,&quot;cy&quot;:41},&quot;region_attributes&quot;:{&quot;category&quot;:&quot;foo&quot;}},</span>
<span class="s2">{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;polygon&quot;,&quot;all_points_x&quot;:[50, 60, 70, 80],&quot;all_points_y&quot;:[51, 61, 71, 81]},&quot;region_attributes&quot;:{&quot;category&quot;:&quot;bar&quot;}},</span>
<span class="s2">{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;polyline&quot;,&quot;all_points_x&quot;:[52, 62, 72, 82],&quot;all_points_y&quot;:[53, 63, 73, 83]},&quot;region_attributes&quot;:{&quot;category&quot;:&quot;foo&quot;}},</span>
<span class="s2">{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;rect&quot;,&quot;x&quot;:90,&quot;y&quot;:91,&quot;width&quot;:10,&quot;height&quot;:20},&quot;region_attributes&quot;:{&quot;category&quot;:&quot;bar&quot;}}],&quot;file_attributes&quot;:</span><span class="si">{}</span><span class="s2">},</span>
<span class="s2">&quot;bar.jpg34&quot;:{&quot;fileref&quot;:&quot;&quot;,&quot;size&quot;:34,&quot;filename&quot;:&quot;bar.jpg&quot;,&quot;regions&quot;:</span><span class="si">{}</span><span class="s2">,&quot;file_attributes&quot;:</span><span class="si">{}</span><span class="s2">}}&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">adapter</span> <span class="o">=</span> <span class="n">VIAAnnotationAdapter</span><span class="p">(</span><span class="n">TEST_FILEPATH</span><span class="p">)</span>

<span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">&#39;__main__.isfile&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">&#39;__main__.open&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">),</span> <span class="n">new</span><span class="o">=</span><span class="n">mock_open</span><span class="p">(</span><span class="n">read_data</span><span class="o">=</span><span class="n">DATA_JSON_V2</span><span class="p">))</span> <span class="k">as</span> <span class="n">_file</span><span class="p">:</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">.</span><span class="n">read_annotations</span><span class="p">()</span>
        <span class="n">_file</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">TEST_FILEPATH</span><span class="p">,</span> <span class="s1">&#39;via_region_data.json&#39;</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">ANNOTATION_TEST_DATA</span><span class="p">)</span>
<span class="n">actual</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-23-4550b37b9282&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         actual <span class="ansi-blue-fg">=</span> adapter<span class="ansi-blue-fg">.</span>read_annotations<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>         _file<span class="ansi-blue-fg">.</span>assert_called_once_with<span class="ansi-blue-fg">(</span>join<span class="ansi-blue-fg">(</span>TEST_FILEPATH<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;via_region_data.json&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>test_eq<span class="ansi-blue-fg">(</span>actual<span class="ansi-blue-fg">,</span> ANNOTATION_TEST_DATA<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> actual

<span class="ansi-green-fg">~/miniconda3/envs/aiforce/lib/python3.7/site-packages/fastcore/test.py</span> in <span class="ansi-cyan-fg">test_eq</span><span class="ansi-blue-fg">(a, b)</span>
<span class="ansi-green-intense-fg ansi-bold">     34</span> <span class="ansi-green-fg">def</span> test_eq<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     35</span>     <span class="ansi-blue-fg">&#34;`test` that `a==b`&#34;</span>
<span class="ansi-green-fg">---&gt; 36</span><span class="ansi-red-fg">     </span>test<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span>b<span class="ansi-blue-fg">,</span>equals<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;==&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span> 
<span class="ansi-green-intense-fg ansi-bold">     38</span> <span class="ansi-red-fg"># Cell</span>

<span class="ansi-green-fg">~/miniconda3/envs/aiforce/lib/python3.7/site-packages/fastcore/test.py</span> in <span class="ansi-cyan-fg">test</span><span class="ansi-blue-fg">(a, b, cmp, cname)</span>
<span class="ansi-green-intense-fg ansi-bold">     24</span>     <span class="ansi-blue-fg">&#34;`assert` that `cmp(a,b)`; display inputs and `cname or cmp.__name__` if it fails&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">     25</span>     <span class="ansi-green-fg">if</span> cname <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> cname<span class="ansi-blue-fg">=</span>cmp<span class="ansi-blue-fg">.</span>__name__
<span class="ansi-green-fg">---&gt; 26</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">assert</span> cmp<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">f&#34;{cname}:\n{a}\n{b}&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">     27</span> 
<span class="ansi-green-intense-fg ansi-bold">     28</span> <span class="ansi-red-fg"># Cell</span>

<span class="ansi-red-fg">AssertionError</span>: ==:
{&#39;foo.jpg12&#39;: &lt;aiforce.annotation.core.Annotation object at 0x7fc190a9acd0&gt;, &#39;bar.jpg34&#39;: &lt;aiforce.annotation.core.Annotation object at 0x7fc190a9a790&gt;}
{&#39;foo.jpg12&#39;: &lt;aiforce.annotation.core.Annotation object at 0x7fc18059b850&gt;, &#39;bar.jpg34&#39;: &lt;aiforce.annotation.core.Annotation object at 0x7fc18059b8d0&gt;}</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

